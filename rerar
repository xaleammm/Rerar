<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>–ú–∏–Ω–∏-—Å–ª–æ—Ç ‚Äî Kodex</title>
<style>
  :root{
    --bg:#0b1020;
    --panel:#0f1724;
    --accent:#ffd633;
    --text:#e6eef8;
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    background:linear-gradient(180deg,#071028 0%, #0b1020 100%);
    color:var(--text);
    display:flex;
    align-items:center;
    justify-content:center;
    height:100vh;
  }

  .wrap{
    width:420px;
    background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.12));
    border:1px solid rgba(255,255,255,0.04);
    border-radius:12px;
    padding:20px;
    box-shadow: 0 10px 30px rgba(2,6,23,0.6);
  }

  h1{font-size:18px;margin:0 0 12px 0;color:var(--accent)}
  .balance{
    font-weight:600;
    margin-bottom:12px;
  }

  .reels{
    display:flex;
    gap:10px;
    justify-content:center;
    margin-bottom:14px;
  }

  .reel{
    width:110px;
    height:110px;
    background:var(--panel);
    border-radius:10px;
    overflow:hidden;
    position:relative;
    border:1px solid rgba(255,255,255,0.03);
    display:flex;
    align-items:center;
    justify-content:center;
  }

  .strip{
    position:absolute;
    top:0;
    left:0;
    width:100%;
    transition: transform 800ms cubic-bezier(.2,.9,.3,1);
  }

  .symbol{
    width:100%;
    height:110px;
    display:flex;
    align-items:center;
    justify-content:center;
    font-size:48px;
    letter-spacing:1px;
    user-select:none;
  }

  .controls{
    display:flex;
    gap:8px;
    justify-content:space-between;
    align-items:center;
  }

  .left{
    display:flex;
    gap:8px;
    align-items:center;
  }

  button{
    background:linear-gradient(180deg,#1b2430,#11151b);
    border:1px solid rgba(255,255,255,0.03);
    padding:8px 12px;
    border-radius:8px;
    color:var(--text);
    cursor:pointer;
    font-weight:600;
  }

  button:active{transform:translateY(1px)}
  .spin{background:linear-gradient(90deg,#ffb84d,#ff8a00); color:#0b1020; box-shadow:0 6px 18px rgba(255,136,0,0.18)}
  .small{padding:6px 8px;font-size:13px}
  .message{height:20px; font-size:14px; text-align:center; margin-top:10px}
  .probabilities{font-size:12px;color:#a8b6d3;margin-top:10px}
</style>
</head>
<body>
  <div class="wrap">
    <h1>Kodex ‚Äî –ú–∏–Ω–∏-—Å–ª–æ—Ç</h1>
    <div class="balance">–ë–∞–ª–∞–Ω—Å: <span id="balance">100</span> –º–æ–Ω–µ—Ç</div>

    <div class="reels">
      <div class="reel" id="reel0"><div class="strip" id="strip0"></div></div>
      <div class="reel" id="reel1"><div class="strip" id="strip1"></div></div>
      <div class="reel" id="reel2"><div class="strip" id="strip2"></div></div>
    </div>

    <div class="controls">
      <div class="left">
        <button id="betDown" class="small">‚àí</button>
        <div style="min-width:72px;text-align:center">–°—Ç–∞–≤–∫–∞: <span id="bet">1</span></div>
        <button id="betUp" class="small">+</button>
      </div>
      <div style="display:flex;gap:8px">
        <button id="spin" class="spin">SPIN</button>
        <button id="max" class="small">MAX</button>
      </div>
    </div>

    <div class="message" id="message"></div>
    <div class="probabilities" id="probs">
      –°–∏–º–≤–æ–ª—ã: 7, üçí –≤–∏—à–Ω—è, BAR, üçá –≤–∏–Ω–æ–≥—Ä–∞–¥. –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏ –º–æ–∂–Ω–æ –º–µ–Ω—è—Ç—å –≤ –∫–æ–¥–µ.
    </div>
  </div>

<script>
/*
  –°–∏–º–≤–æ–ª—ã –∏ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏:
  - 7
  - cherry (–≤–∏—à–Ω—è)
  - bar
  - grapes (–≤–∏–Ω–æ–≥—Ä–∞–¥)

  –ß—Ç–æ–±—ã –ø–æ–º–µ–Ω—è—Ç—å —à–∞–Ω—Å—ã ‚Äî –∏–∑–º–µ–Ω–∏—Ç–µ –º–∞—Å—Å–∏–≤ `symbols` –ø–æ–ª–µ weight.
  –õ–æ–≥–∏–∫–∞: –∫–∞–∂–¥–∞—è –∫–∞—Ç—É—à–∫–∞ –≤—ã–±–∏—Ä–∞–µ—Ç —Å–∏–º–≤–æ–ª –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –ø–æ –≤–µ—Å–∞–º.
*/

const symbols = [
  {id:'7',   label:'7',    weight:6},   // –±–æ–ª–µ–µ —Ä–µ–¥–∫–∏–π ‚Äî —Å—Ç–∞–≤—å—Ç–µ –º–µ–Ω—å—à–µ
  {id:'ch',  label:'üçí',  weight:20},
  {id:'bar', label:'BAR',  weight:10},
  {id:'gr',  label:'üçá',  weight:18},
];

// –≤—ã–ø–ª–∞—Ç—ã (–∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã) ‚Äî –º–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å
const payouts = {
  '7,7,7': 100,
  'ch,ch,ch': 20,
  'bar,bar,bar': 40,
  'gr,gr,gr': 15,
  // —á–∞—Å—Ç–∏—á–Ω—ã–µ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏
  'ch,ch,*': 2,
  '*,ch,ch': 2,
};

// –Ω–∞—á–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
let balance = 300;
let bet = 2;
const minBet = 1;
const maxBet = 2000;
const reelsCount = 3;

// UI —ç–ª–µ–º–µ–Ω—Ç—ã
const balanceEl = document.getElementById('balance');
const betEl = document.getElementById('bet');
const messageEl = document.getElementById('message');
const spinBtn = document.getElementById('spin');
const maxBtn = document.getElementById('max');
const betDown = document.getElementById('betDown');
const betUp = document.getElementById('betUp');

function updateUI(){
  balanceEl.textContent = balance;
  betEl.textContent = bet;
}

// build visual strips ‚Äî each reel will contain repeated sequence to animate
function buildStrips(){
  for(let r=0;r<reelsCount;r++){
    const strip = document.getElementById('strip'+r);
    strip.innerHTML = '';
    // we'll repeat symbols 8 times for smooth spin
    for(let i=0;i<8;i++){
      for(const s of symbols){
        const div = document.createElement('div');
        div.className = 'symbol';
        div.dataset.id = s.id;
        div.textContent = s.label;
        strip.appendChild(div);
      }
    }
  }
}

// Random –≤—ã–±–æ—Ä –ø–æ –≤–µ—Å–∞–º
function weightedPick(){
  const total = symbols.reduce((acc,s)=>acc+s.weight,0);
  let rnd = Math.random()*total;
  for(const s of symbols){
    if(rnd < s.weight) return s;
    rnd -= s.weight;
  }
  return symbols[symbols.length-1];
}

// –ü–æ–ª—É—á–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç (id-—ã) –¥–ª—è –≤—Å–µ—Ö –∫–∞—Ç—É—à–µ–∫
function spinOnce(){
  const result = [];
  for(let i=0;i<reelsCount;i++){
    result.push(weightedPick().id);
  }
  return result;
}

// –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –≤—ã–ø–ª–∞—Ç—É –ø–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É
function evaluate(result){
  const key = result.join(',');
  if(payouts[key]) return payouts[key];

  // —á–∞—Å—Ç–∏—á–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã: –¥–≤–µ –≤–∏—à–Ω–∏ –ø–æ–¥—Ä—è–¥ (–≤ –Ω–∞—á–∞–ª–µ –∏–ª–∏ –∫–æ–Ω—Ü–µ)
  if((result[0]==='ch' && result[1]==='ch') || (result[1]==='ch' && result[2]==='ch')) return payouts['ch,ch,*'] || 0;

  return 0;
}

// –∞–Ω–∏–º–∏—Ä—É–µ–º –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –ø–æ–ª–æ—Å (strip) —Ç–∞–∫, —á—Ç–æ–±—ã —Ü–µ–Ω—Ç—Ä –∫–∞–∂–¥–æ–π –∫–∞—Ç—É—à–∫–∏ –æ—Å—Ç–∞–Ω–æ–≤–∏–ª—Å—è –Ω–∞ –Ω—É–∂–Ω–æ–º —Å–∏–º–≤–æ–ª–µ
function animateReels(finalIds){
  return new Promise(resolve=>{
    const baseDelay = 200;
    for(let r=0;r<reelsCount;r++){
      const strip = document.getElementById('strip'+r);
      // –≤—ã—Å–æ—Ç–∞ –æ–¥–Ω–æ–≥–æ —Å–∏–º–≤–æ–ª–∞
      const symHeight = strip.firstElementChild.getBoundingClientRect().height || 110;
      // –Ω–∞–π–¥—ë–º –∏–Ω–¥–µ–∫—Å –ø–µ—Ä–≤–æ–≥–æ –≤—Ö–æ–∂–¥–µ–Ω–∏—è –Ω—É–∂–Ω–æ–≥–æ —Å–∏–º–≤–æ–ª–∞ –≤–Ω—É—Ç—Ä–∏ strip (–≤ –ø–µ—Ä–≤–æ–π –ø–æ–≤—Ç–æ—Ä—è—é—â–µ–π—Å—è –≥—Ä—É–ø–ø–µ)
      const nodes = Array.from(strip.querySelectorAll('.symbol'));
      let targetIndex = nodes.findIndex(n=>n.dataset.id===finalIds[r]);
      if(targetIndex === -1) targetIndex = 0;
      // —Ö–æ—Ç–∏–º –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å—Å—è —Ç–∞–∫, —á—Ç–æ–±—ã –≤—ã–±—Ä–∞–Ω–Ω—ã–π —Å–∏–º–≤–æ–ª –æ–∫–∞–∑–∞–ª—Å—è –ø–æ —Ü–µ–Ω—Ç—Ä—É: –ø—Ä–∏–º–µ—Ä–Ω–æ –≤—Ç–æ—Ä–æ–π –±–ª–æ–∫ (–ø–∞–¥–µ–Ω–∏–µ –≤–Ω–∏–∑)
      // —Ç.–∫. —É –Ω–∞—Å –º–Ω–æ–≥–æ –ø–æ–≤—Ç–æ—Ä–æ–≤, –¥–æ–±–∞–≤–∏–º –ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª + –∏–Ω–¥–µ–∫—Å, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –ø–ª–∞–≤–Ω—É—é –ø—Ä–æ–∫—Ä—É—Ç–∫—É.
      const cycles = 4 + r; // —Ä–∞–∑–Ω—ã–µ –ø–æ –≤—Ä–µ–º–µ–Ω–∏
      const totalSymbols = nodes.length;
      const finalPosIndex = cycles * (symbols.length) + targetIndex;
      const translateY = - finalPosIndex * symHeight + ( (strip.parentElement.clientHeight - symHeight)/2 );
      // —É—Å—Ç–∞–Ω–æ–≤–∏–º –ø–µ—Ä–µ—Ö–æ–¥ —Å —Ä–∞–∑–Ω–æ–π –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é
      strip.style.transition = `transform ${900 + r*250}ms cubic-bezier(.2,.9,.3,1)`;
      // –∑–∞–¥–µ—Ä–∂–∫–∞ —á—Ç–æ–±—ã –∫–∞—Ç—É—à–∫–∏ –Ω–µ —Å—Ç–∞—Ä—Ç–æ–≤–∞–ª–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
      setTimeout(()=> strip.style.transform = `translateY(${translateY}px)`, r*baseDelay);
    }
    // resolve –ø–æ—Å–ª–µ —Å–∞–º–æ–π –¥–ª–∏–Ω–Ω–æ–π –∞–Ω–∏–º–∞—Ü–∏–∏
    const maxTime = 900 + (reelsCount-1)*250 + baseDelay*(reelsCount-1);
    setTimeout(resolve, maxTime + 80);
  });
}

async function doSpin(){
  if(balance < bet){
    messageEl.textContent = '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç.';
    return;
  }
  balance -= bet;
  updateUI();
  spinBtn.disabled = true;
  messageEl.textContent = '–ö—Ä—É—Ç–∏–º...';

  // –æ–ø—Ä–µ–¥–µ–ª—è–µ–º —Ñ–∏–Ω–∞–ª—å–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã (–ø–æ –≤–µ—Å–∞–º)
  const final = spinOnce(); // –º–∞—Å—Å–∏–≤ id-–æ–≤
  // –≤–∏–∑—É–∞–ª–∏–∑–∏—Ä—É–µ–º: —Å–Ω–∞—á–∞–ª–∞ –ø–µ—Ä–µ–º–µ—à–∞–µ–º –ø–æ–ª–æ—Å—ã –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∞
  buildStrips();

  // –Ω–µ–º–Ω–æ–∂–∫–æ —Ä–∞–Ω–¥–æ–º–∞ –≤ –Ω–∞—á–∞–ª–µ, —á—Ç–æ–±—ã strip –±—ã–ª –Ω–µ –≤ –Ω—É–ª–µ–≤–æ–π –ø–æ–∑–∏—Ü–∏–∏
  for(let r=0;r<reelsCount;r++){
    const strip = document.getElementById('strip'+r);
    strip.style.transition = 'none';
    strip.style.transform = `translateY(${ -Math.random()*300 }px)`;
  }

  // –∑–∞–ø—É—Å–∫–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é, –¥–æ–∂–¥—ë–º—Å—è –µ—ë –æ–∫–æ–Ω—á–∞–Ω–∏—è
  await animateReels(final);

  // –æ—Ü–µ–Ω–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
  const winMultiplier = evaluate(final);
  const win = winMultiplier * bet;
  if(win > 0){
    balance += win;
    messageEl.textContent = `–í—ã –≤—ã–∏–≥—Ä–∞–ª–∏ ${win} –º–æ–Ω–µ—Ç! (${final.map(idToLabel).join(' ')})`;
  } else {
    messageEl.textContent = `–ü—Ä–æ–∏–≥—Ä—ã—à. (${final.map(idToLabel).join(' ')})`;
  }
  updateUI();
  spinBtn.disabled = false;
}

// –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ UI
function idToLabel(id){
  const s = symbols.find(x=>x.id===id);
  return s ? s.label : id;
}

// –∫–Ω–æ–ø–∫–∏
spinBtn.addEventListener('click', doSpin);
betDown.addEventListener('click', ()=>{
  bet = Math.max(minBet, bet-1); updateUI();
});
betUp.addEventListener('click', ()=>{
  bet = Math.min(maxBet, bet+1); updateUI();
});
maxBtn.addEventListener('click', ()=>{
  bet = Math.min(maxBet, Math.max(minBet, Math.floor(balance/1) || minBet)); updateUI();
});

// –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
buildStrips();
updateUI();

// –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–µ–∫—É—â–∏–µ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏ (—Ä–∞—Å—á–∏—Ç–∞–Ω–Ω—ã–µ –∏–∑ –≤–µ—Å–æ–≤)
(function showProbabilities(){
  const total = symbols.reduce((a,s)=>a+s.weight,0);
  const lines = symbols.map(s=>{
    const p = (s.weight/total*100).toFixed(1);
    return `${s.label} ‚Äî ${p}%`;
  });
  document.getElementById('probs').textContent = '–®–∞–Ω—Å—ã (–ø—Ä–∏–º–µ—Ä–Ω–æ): ' + lines.join(' ¬∑ ');
})();
</script>
</body>
</html>